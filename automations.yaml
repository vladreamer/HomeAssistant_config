- id: 'VladsRoomLightScene_20181106'
########################################################
## LightScene in Vlad's Room 
## Turn Dimmer Switch (VladsRoom ID:29) "ON" with 55 brightness 
## if it was "OFF" triggered by Multisensor3 after 6pm
########################################################
  alias: "Vlad's LightScene 18:00-22:30"
  trigger:
    - entity_id: binary_sensor.multi03_motion
      platform: state
      to: 'on'
  condition:
    - condition: time
      after: '18:00:00'
      before: '22:30:00'
    - condition: state
      entity_id: light.zooz_zen22_dimmer_v2_2_level 
      state: 'off'
  action:
     service: scene.turn_on
     entity_id: scene.lightlow_vlad

- id: 'VladsRoomLightOFF_20181106'
########################################################
## Turn Dimmer switch (ID:29) "OFF" if it was "ON" triggered by
## Multisensor3 after 15 minutes "NO MOTION" after 10:30pm
########################################################
  alias: "Vlad's Dimmer OFF 15min after 23:30"
  trigger:
  - entity_id: binary_sensor.multi03_motion
    for:
      minutes: 15
    platform: state
    to: 'off'
  condition:
    - condition: time
      after: '23:30:00'
    - condition: state
      entity_id: light.zooz_zen22_dimmer_v2_2_level
      state: 'on'
  action:
  - service: homeassistant.turn_off
    entity_id: light.zooz_zen22_dimmer_v2_2_level


- id: 'TempMorning_2018111400'
########################################################
## Thrmostat (ID:28) 
########################################################
  alias: "TEMP 22C Morning"
  trigger:
    - platform: template
      value_template: "{% if states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') | float < 22 %} true {% endif %}"
    - platform: time
      at: '07:15:00'
  condition:
    - condition: time
      after: '07:15:00'
      before: '08:59:00'
  action:
    - service: climate.set_temperature
      data:
       entity_id: climate.2gig_technologies_ct101_thermostat_iris_heating_1
       temperature: 22
       operation_mode: Heat
    - service: notify.MailtoPykodel
      data_template:
        title: "Morning Temperature to 22C {{ now().strftime('%d %b, %Y %-I:%M %P') }}"
        message: "Current Temperature is {{ states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') }}"

        
- id: 'TempDay_2018111400'
########################################################
## Thrmostat (ID:28) 
########################################################
  alias: "TEMP 21C Day"
  trigger:
    - platform: template
      value_template: "{% if states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') | float > 21.5 %} true {% endif %}"
    - platform: template
      value_template: "{% if states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') | float < 20.5 %} true {% endif %}"
    - platform: time
      at: '09:00:00'    
  condition:
    - condition: time
      after: '09:00:00'
      before: '17:29:00'
  action:
    - service: climate.set_temperature
      data:
       entity_id: climate.2gig_technologies_ct101_thermostat_iris_heating_1
       temperature: 21
       operation_mode: Heat
    - service: notify.MailtoPykodel
      data_template:
        title: "Day Temperature to 21C {{ now().strftime('%d %b, %Y %-I:%M %P') }}"
        message: "Current Temperature is {{ states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') }}"
        
- id: 'TempEve_2018111400'
########################################################
## Thrmostat (ID:28) 
########################################################
  alias: "TEMP 22C Evening"
  trigger:
    - platform: template
      value_template: "{% if states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') | float < 22 %} true {% endif %}"
    - platform: time
      at: '17:30:00'    
  condition:
    - condition: time
      after: '17:30:00'
      before: '22:29:00'
  action:
    - service: climate.set_temperature
      data:
       entity_id: climate.2gig_technologies_ct101_thermostat_iris_heating_1
       temperature: 22
       operation_mode: Heat
    - service: notify.MailtoPykodel
      data_template:
        title: "Evening Temperature to 22C {{ now().strftime('%d %b, %Y %-I:%M %P') }}"
        message: "Current Temperature is {{ states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') }}"
        
- id: 'TempNight_2018111400'
########################################################
## Thrmostat (ID:28) 
########################################################
  alias: "TEMP 20C Night" 
  trigger:
    - platform: template
      value_template: "{% if states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') | float > 20.5 %} true {% endif %}"
    - platform: template
      value_template: "{% if states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') | float < 19.5 %} true {% endif %}"
    - platform: time
      at: '22:30:00'    
  condition:
    - condition: time
      after: '22:30:00'
      before: '07:14:00'
  action:
    - service: climate.set_temperature
      data:
       entity_id: climate.2gig_technologies_ct101_thermostat_iris_heating_1
       temperature: 20
       operation_mode: Heat
    - service: notify.MailtoPykodel
      data_template:
        title: "Night Temperature to 20C {{ now().strftime('%d %b, %Y %-I:%M %P') }}"
        message: "Current Temperature is {{ states('sensor.2gig_technologies_ct101_thermostat_iris_temperature') }}"


- id: 'ResetEnergySensors_2018110500'
########################################################
## Reset Home Energy Meter (ID:25) monthly consumption 
########################################################
  alias: Reset HEM (ID:25) monthly 
  trigger:
      platform: time
      at: "00:00:00"
  condition:
     condition: template
     value_template: "{{ now().date().day == 1 }}" 
  action:
    - service: notify.MailtoPykodel
      data_template:
        title: "Energy iused {{states.sensor.aeotec_zw095_home_energy_meter_gen5_energy.state}} kWh"
        message: "Total Energy Used per month is {{states.sensor.aeotec_zw095_home_energy_meter_gen5_energy.state}} kWh
    
        ID:21 - GreatRoomSW - {{states.sensor.hank_hkzwso03_smart_plug_energy01.state}} kWh;
        
        ID:8  - BasementSW - {{states.sensor.neo_coolcam_power_plug_12a_energy01.state}} kWh;
        
        ID:10 - GreatRoomSW - {{states.sensor.neo_coolcam_power_plug_12a_energy02.state}} kWh;
        
        ID:12 - Vlad'sRoomSW - {{states.sensor.neo_coolcam_power_plug_12a_energy03.state}} kWh;
        
        ID:14 - ChatRoomSW - {{states.sensor.neo_coolcam_power_plug_12a_energy04.state}} kWh;"
    - service: zwave.reset_node_meters 
      data: {"node_id": 25}
    - service: zwave.reset_node_meters 
      data: {"node_id": 21}
    - service: zwave.reset_node_meters 
      data: {"node_id": 8}
    - service: zwave.reset_node_meters 
      data: {"node_id": 10}
    - service: zwave.reset_node_meters 
      data: {"node_id": 12}
    - service: zwave.reset_node_meters 
      data: {"node_id": 14}
    


- id: 'MasterRoom_LighON_2018082601'
########################################################
## Turn Light ON MAsterBedroom if it was "OFF" triggered by
## Multisensor4 After that take 4 snapshoots and send
## them by mail "notify.MailtoPykodel"
########################################################
  alias: "MasterRoom LightScene 18:00-22:30"
 #alias: Inolelli01SW2 ON before 22:50 
  trigger:
    - entity_id: binary_sensor.multi04_motion
      platform: state
      to: 'on'
  condition:
    - condition: time
      after: '18:00:00'
      before: '22:40:00'
      #weekday:
      #- mon  
      #- tue
      #- wed
      #- thu
      #- fri     
    - condition: state
      #entity_id: switch.inovelli_2ch_01_2
      entity_id: light.zooz_zen22_dimmer_v2_1_level 
      state: 'off'
  action:
   #- service: homeassistant.turn_on
   #  entity_id: switch.inovelli_2ch_01_2
     service: scene.turn_on
     entity_id: scene.lightlow_master


- id: 'MasterRoom_LighOFF_2018082602'
########################################################
## Turn Dimmer "OFF" if it was "ON" triggered by
## Multisensor4 after 15 minutes "NO MOTION"
##
########################################################
  alias: "Master Dimmer OFF 15min"
 #alias: Inovelli01SW2 OFF after 15min
  trigger:
  - entity_id: binary_sensor.multi04_motion
    for:
      minutes: 15
    platform: state
    to: 'off'
  condition:
  - condition: state
    #entity_id: switch.inovelli_2ch_01_2
    entity_id: light.zooz_zen22_dimmer_v2_1_level
    state: 'on'
  action:
  - service: homeassistant.turn_off
    #entity_id: switch.inovelli_2ch_01_2
    entity_id: light.zooz_zen22_dimmer_v2_1_level




- id: '20180083001' 
########################################################
## Basement StairsLigth "ON" if it was "OFF" triggered by 
## Multisensor1 After that take 4 snapshoots and send
## them by mail "notify.MailtoPykodel" 
########################################################
  alias: Basement StairsLight ON
  trigger:
    - entity_id: binary_sensor.multi01_motion
      platform: state
      to: 'on'
  condition:
    - condition: state
      #entity_id: switch.neo_coolcam_power_plug_12a_switch01
      entity_id: switch.zooz_zen21_switch_v20_switch_01 
      state: 'off'
  action:
    - service: homeassistant.turn_on 
      #entity_id: switch.neo_coolcam_power_plug_12a_switch01
      entity_id: switch.zooz_zen21_switch_v20_switch_01 
    - service: camera.snapshot
      data:
        entity_id: camera.camera4
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_01.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_01.jpg"
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_01cor.jpg"
    - delay: '00:00:02'
    - service: camera.snapshot
      data:
        entity_id: camera.camera4
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_02.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_02.jpg"
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_02cor.jpg"
    - delay: '00:00:12'
    - service: camera.snapshot
      data:
        entity_id: camera.camera4
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_03.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_03.jpg"
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_03cor.jpg"
    - delay: '00:00:25'
    - service: camera.snapshot
      data:
        entity_id: camera.camera4
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_04.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_04.jpg"
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera4_04cor.jpg"
    - service: notify.MailtoPykodel
      data_template:
        title: "Basement Motion Detected"
        message: "Motion Detected in Basement by Multisensor Multi01"
        data:
          images:
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera4_01cor.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera4_02cor.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera4_03cor.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera4_04cor.jpg
          html: >
            <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
            <html lang="en" xmlns="http://www.w3.org/1999/xhtml">
              <head>

                <meta charset="UTF-8">
                <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Switch1 Triggered</title>
                <style type="text/css">
                  h1,h2,h3,h4,h5,h6 {
                  font-family:Arial,sans-serif;
                  }
                </style>
              </head>
              <body>
                <h1>Motion in Basement  0sec</h1>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera4?api_password=3health1">
                <img style="width: 100%; alt="Image1 from Camera4" src="cid:snapshot_camera4_01cor.jpg" /></a>
                <h4>4 sec</h4>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera4?api_password=3health1">
                <img style="width: 100%; alt="Image2 from Camera4" src="cid:snapshot_camera4_02cor.jpg" /></a>
                <h4>16 sec</h4>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera4?api_password=3health1">
                <img style="width: 100%; alt="Image3 from Camera4" src="cid:snapshot_camera4_03cor.jpg" /></a>
                <h4>32 sec</h4>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera4?api_password=3health1">
                <img style="width: 100%; alt="Image3 from Camera4" src="cid:snapshot_camera4_04cor.jpg" /></a>
              </body>
            </html>
#
#
- id: '2018083002'
########################################################
## Basement StairsLight "OFF" if it was "ON" triggered by
## Multisensor1 after 15 minutes "NO MOTION"
##
########################################################
  alias: Basement StairsLight 3min OFF
  trigger:
  - entity_id: binary_sensor.multi01_motion
    for:
      minutes: 2
    platform: state
    to: 'off'
  condition:
  - condition: state
    #entity_id: switch.neo_coolcam_power_plug_12a_switch01
    entity_id: switch.zooz_zen21_switch_v20_switch_01
    state: 'on'
  action:
  - service: homeassistant.turn_off
    #entity_id: switch.neo_coolcam_power_plug_12a_switch01
    entity_id: switch.zooz_zen21_switch_v20_switch_01
#
#
#
- id: '2018073002' 
########################################################
## Turn switch Neo3 "OFF" if it was "ON" triggered by 
## Multisensor1 after 15 minutes "NO MOTION"
##  
########################################################
  alias: Turn off Neo3 3 minutes after last movement
  trigger:
  - entity_id: binary_sensor.multisensor2_motion
    for:
      minutes: 15
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.neo_coolcam_power_plug_12a_switch_33
    state: 'on'
  action:
  - service: homeassistant.turn_off 
    entity_id: switch.neo_coolcam_power_plug_12a_switch_33
#
#
#
- id: '2018100300'
########################################################
## Triger by EZM01 ID 23 (MainFloor_Motion) 
## Take 4 snapshoots and send them by mail "notify.MailtoPykodel" 
## 
########################################################
  alias: Snapshots trigered by EZM01 ID:23
  trigger:
    - entity_id: binary_sensor.ezm01_motion
      platform: state
      to: 'on'
  condition:
    - condition: time
      after: '14:30:00'
      before: '22:50:00'    
  action:
    - service: camera.snapshot
      data:
        entity_id: camera.camera1
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera1_01.jpg"
    - service: camera.snapshot
      data:
        entity_id: camera.camera2
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_01.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_01.jpg"  
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_01cor.jpg"  
    - delay: '00:00:02'
    - service: camera.snapshot
      data:
        entity_id: camera.camera1
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera1_02.jpg"
    - service: camera.snapshot
      data:
        entity_id: camera.camera2
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_02.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_02.jpg"  
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_02cor.jpg"  
    - delay: '00:00:12'
    - service: camera.snapshot
      data:
        entity_id: camera.camera1
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera1_03.jpg"
    - service: camera.snapshot
      data:
        entity_id: camera.camera2
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_03.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_03.jpg"  
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_03cor.jpg"  
    - delay: '00:00:25'
    - service: camera.snapshot
      data:
        entity_id: camera.camera1
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera1_04.jpg"
    - service: camera.snapshot
      data:
        entity_id: camera.camera2
        filename: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_04.jpg"
    - service: shell_command.fix_snapshot
      data:
        filename1: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_04.jpg"  
        filename2: "/home/homeassistant/.homeassistant/downloads/snapshot_camera2_04cor.jpg"  
    - service: notify.MailtoPykodel
      data_template:
        title: "MainFloor Motion detected"
        message: "MainFloor Motion detected"
        data:
          images:
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera1_01.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera1_02.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera1_03.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera1_04.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera2_01cor.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera2_02cor.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera2_03cor.jpg
            - /home/homeassistant/.homeassistant/downloads/snapshot_camera2_04cor.jpg
          
          html: >
            <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
            <html lang="en" xmlns="http://www.w3.org/1999/xhtml">
              <head>
                <meta charset="UTF-8">
                <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>MainFloor Motion detected</title>
                <style type="text/css">
                  h1,h2,h3,h4,h5,h6 {
                  font-family:Arial,sans-serif;
                  }
                </style>
              </head>
              <body>
                <h1>MainFloor Motion detected (Camera1) 0sec</h1>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera1?api_password=3health1">
                <img style="width: 100%; alt="Image1 from Camera1" src="cid:snapshot_camera1_01.jpg" /></a>
                <h6>4 sec</h6>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera1?api_password=3health1">
                <img style="width: 100%; alt="Image2 from Camera1" src="cid:snapshot_camera1_02.jpg" /></a>
                <h6>16 sec</h6>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera1?api_password=3health1">
                <img style="width: 100%; alt="Image3 from Camera1" src="cid:snapshot_camera1_03.jpg" /></a>
                <h6>32 sec</h6>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera1?api_password=3health1">
                <img style="width: 100%; alt="Image3 from Camera1" src="cid:snapshot_camera1_04.jpg" /></a>
                <h1>MainFloor Motion detected (Camera2) 0sec</h1>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera2?api_password=3health1">
                <img style="width: 100%; alt="Image1 from Camera2" src="cid:snapshot_camera2_01cor.jpg" /></a>
                <h6>4 sec</h6>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera2?api_password=3health1">
                <img style="width: 100%; alt="Image2 from Camera2" src="cid:snapshot_camera2_02cor.jpg" /></a>
                <h6>16 sec</h6>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera2?api_password=3health1">
                <img style="width: 100%; alt="Image3 from Camera2" src="cid:snapshot_camera2_03cor.jpg" /></a>
                <h6>32 sec</h6>
                <a href="https://jumpier-panther-8852.dataplicity.io/api/camera_proxy_stream/camera.camera2?api_password=3health1">
                <img style="width: 100%; alt="Image3 from Camera2" src="cid:snapshot_camera2_04cor.jpg" /></a>
              </body>
            </html>
#
#
#
- id: '2018073004'
########################################################
## Turn Water Valve "OFF" if it was "ON" triggered by 
## Water Leak sensor from "OFF" to "ON". After that send
## an mail "notify.MailtoPykodel" 
########################################################
  alias: Auto_Switch_Water
  trigger:
  - entity_id: binary_sensor.neo_coolcam_water_leakage_detector_sensor01
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.sigma_valveswitch
    state: 'on'
  action:
  - service: homeassistant.turn_off
    entity_id: switch.sigma_valveswitch
  - service: notify.MailtoPykodel
    data:
      title: "FLOOD ALERT"
      message: "WaterSwitch trigerred by WaterLeak sensor"
